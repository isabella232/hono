<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1423.2" height="729.6" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:1423px;height:729px" preserveAspectRatio="none" version="1.1" viewBox="0 0 1423 729" zoomAndPan="magnify"><defs><filter id="f1bcnn0h64qkyn" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.4"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.8" dy="4.8" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect style="stroke:#a80036;stroke-width:1.2" width="12" height="34.959" x="1044.6" y="210.834" fill="#FFF" filter="url(#f1bcnn0h64qkyn)"/><rect style="stroke:#a80036;stroke-width:1.2" width="12" height="136.397" x="1205.4" y="432.591" fill="#FFF" filter="url(#f1bcnn0h64qkyn)"/><line style="stroke:#a80036;stroke-width:1.2;stroke-dasharray:5,5" x1="84" x2="84" y1="103.556" y2="625.547"/><line style="stroke:#a80036;stroke-width:1.2;stroke-dasharray:5,5" x1="285.6" x2="285.6" y1="103.556" y2="625.547"/><line style="stroke:#a80036;stroke-width:1.2;stroke-dasharray:5,5" x1="675.6" x2="675.6" y1="103.556" y2="625.547"/><line style="stroke:#a80036;stroke-width:1.2;stroke-dasharray:5,5" x1="1050.6" x2="1050.6" y1="103.556" y2="625.547"/><line style="stroke:#a80036;stroke-width:1.2;stroke-dasharray:5,5" x1="1211.4" x2="1211.4" y1="103.556" y2="625.547"/><text x="9.6" y="99.594" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="142.8">Bluetooth Device</text><ellipse cx="84.6" cy="15.6" fill="#FEFECE" filter="url(#f1bcnn0h64qkyn)" rx="9.6" ry="9.6" style="stroke:#a80036;stroke-width:2.4"/><path fill="none" d="M84.6,25.2 L84.6,57.6 M69,34.8 L100.2,34.8 M84.6,57.6 L69,75.6 M84.6,57.6 L100.2,75.6" filter="url(#f1bcnn0h64qkyn)" style="stroke:#a80036;stroke-width:2.4"/><text x="9.6" y="639.941" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="142.8">Bluetooth Device</text><ellipse cx="84.6" cy="655.903" fill="#FEFECE" filter="url(#f1bcnn0h64qkyn)" rx="9.6" ry="9.6" style="stroke:#a80036;stroke-width:2.4"/><path fill="none" d="M84.6,665.5031 L84.6,697.9031 M69,675.1031 L100.2,675.1031 M84.6,697.9031 L69,715.9031 M84.6,697.9031 L100.2,715.9031" filter="url(#f1bcnn0h64qkyn)" style="stroke:#a80036;stroke-width:2.4"/><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="87.6" height="36.356" x="240" y="61.2" fill="#FEFECE" filter="url(#f1bcnn0h64qkyn)"/><text x="248.4" y="85.194" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="70.8">Gateway</text><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="87.6" height="36.356" x="240" y="624.347" fill="#FEFECE" filter="url(#f1bcnn0h64qkyn)"/><text x="248.4" y="648.341" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="70.8">Gateway</text><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="135.6" height="36.356" x="606" y="61.2" fill="orange" filter="url(#f1bcnn0h64qkyn)"/><text x="614.4" y="85.194" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="118.8">MQTT Adapter</text><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="135.6" height="36.356" x="606" y="624.347" fill="orange" filter="url(#f1bcnn0h64qkyn)"/><text x="614.4" y="648.341" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="118.8">MQTT Adapter</text><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="110.4" height="36.356" x="993" y="61.2" fill="orange" filter="url(#f1bcnn0h64qkyn)"/><text x="1001.4" y="85.194" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="93.6">Credentials</text><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="110.4" height="36.356" x="993" y="624.347" fill="orange" filter="url(#f1bcnn0h64qkyn)"/><text x="1001.4" y="648.341" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="93.6">Credentials</text><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="177.6" height="36.356" x="1120.2" y="61.2" fill="orange" filter="url(#f1bcnn0h64qkyn)"/><text x="1128.6" y="85.194" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="160.8">Device Registration</text><rect style="stroke:#a80036;stroke-width:1.7999999999999998" width="177.6" height="36.356" x="1120.2" y="624.347" fill="orange" filter="url(#f1bcnn0h64qkyn)"/><text x="1128.6" y="648.341" fill="#000" font-family="sans-serif" font-size="16.8" lengthAdjust="spacingAndGlyphs" textLength="160.8">Device Registration</text><rect style="stroke:#a80036;stroke-width:1.2" width="12" height="34.959" x="1044.6" y="210.834" fill="#FFF" filter="url(#f1bcnn0h64qkyn)"/><rect style="stroke:#a80036;stroke-width:1.2" width="12" height="136.397" x="1205.4" y="432.591" fill="#FFF" filter="url(#f1bcnn0h64qkyn)"/><polygon fill="#A80036" points="271.8 136.116 283.8 140.916 271.8 145.716 276.6 140.916" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="84.6" x2="279" y1="140.916" y2="140.916"/><text x="93" y="134.837" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">1</text><text x="108.6" y="134.837" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="157.2">establish connection</text><polygon fill="#A80036" points="661.8 171.075 673.8 175.875 661.8 180.675 666.6 175.875" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="286.2" x2="669" y1="175.875" y2="175.875"/><text x="294.6" y="169.796" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">2</text><text x="310.2" y="169.796" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="306">CONNECT(tenant, gatewayId, password)</text><polygon fill="#A80036" points="1030.2 206.034 1042.2 210.834 1030.2 215.634 1035 210.834" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="676.2" x2="1037.4" y1="210.834" y2="210.834"/><text x="684.6" y="204.755" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">3</text><text x="700.2" y="204.755" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="330">get(tenant, gatewayId, &quot;hashed-password&quot;)</text><polygon fill="#A80036" points="689.4 240.994 677.4 245.794 689.4 250.594 684.6 245.794" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2;stroke-dasharray:2,2" x1="682.2" x2="1049.4" y1="245.794" y2="245.794"/><text x="696.6" y="239.715" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">4</text><text x="712.2" y="239.715" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="114">password hash</text><path fill="#FBFB77" d="M596.4,261.3938 L596.4,291.3938 L751.2,291.3938 L751.2,273.3938 L739.2,261.3938 L596.4,261.3938" filter="url(#f1bcnn0h64qkyn)" style="stroke:#a80036;stroke-width:1.2"/><path fill="#FBFB77" d="M739.2,261.3938 L739.2,273.3938 L751.2,273.3938 L739.2,261.3938" style="stroke:#a80036;stroke-width:1.2"/><text x="603.6" y="281.874" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="129.6">verify credentials</text><polygon fill="#A80036" points="299.4 322.913 287.4 327.712 299.4 332.512 294.6 327.712" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="292.2" x2="675" y1="327.712" y2="327.712"/><text x="306.6" y="321.633" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">5</text><text x="322.2" y="321.633" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="66">CONACK</text><polygon fill="#A80036" points="271.8 357.872 283.8 362.672 271.8 367.472 276.6 362.672" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="84.6" x2="279" y1="362.672" y2="362.672"/><text x="93" y="356.593" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">6</text><text x="108.6" y="356.593" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="97.2">sensor value</text><polygon fill="#A80036" points="661.8 392.831 673.8 397.631 661.8 402.431 666.6 397.631" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="286.2" x2="669" y1="397.631" y2="397.631"/><text x="294.6" y="391.552" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">7</text><text x="310.2" y="391.552" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="345.6">PUBLISH(&quot;t/$tenant/$deviceId&quot;, sensor value)</text><polygon fill="#A80036" points="1191 427.791 1203 432.591 1191 437.391 1195.8 432.591" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="676.2" x2="1198.2" y1="432.591" y2="432.591"/><text x="684.6" y="426.512" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">8</text><text x="700.2" y="426.512" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="282">assert(tenantId, deviceId, gatewayId)</text><path fill="#FBFB77" d="M1008,448.1906 L1008,532.1906 L1408.8,532.1906 L1408.8,460.1906 L1396.8,448.1906 L1008,448.1906" filter="url(#f1bcnn0h64qkyn)" style="stroke:#a80036;stroke-width:1.2"/><path fill="#FBFB77" d="M1396.8,448.1906 L1396.8,460.1906 L1408.8,460.1906 L1396.8,448.1906" style="stroke:#a80036;stroke-width:1.2"/><text x="1015.2" y="468.671" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="76.8">verify that</text><text x="1015.2" y="486.83" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="202.8">- device and gateway exist</text><text x="1015.2" y="504.99" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="258">- device and gateway are enabled</text><text x="1015.2" y="523.149" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="375.6">- gateway is authorized to act on behalf of device</text><polygon fill="#A80036" points="689.4 564.188 677.4 568.987 689.4 573.788 684.6 568.987" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2;stroke-dasharray:2,2" x1="682.2" x2="1210.2" y1="568.987" y2="568.987"/><text x="696.6" y="562.908" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8">9</text><text x="712.2" y="562.908" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="18">ok</text><polygon fill="#A80036" points="299.4 599.147 287.4 603.947 299.4 608.747 294.6 603.947" style="stroke:#a80036;stroke-width:1.2"/><line style="stroke:#a80036;stroke-width:1.2" x1="292.2" x2="675" y1="603.947" y2="603.947"/><text x="306.6" y="597.868" fill="#000" font-family="sans-serif" font-size="15.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21.6">10</text><text x="333" y="597.868" fill="#000" font-family="sans-serif" font-size="15.6" lengthAdjust="spacingAndGlyphs" textLength="63.6">PUBACK</text></g></svg>